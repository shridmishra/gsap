<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spotlight Gallery</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=PP+Neue+Montreal&family=Manrope:wght@400;700&family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&family=Lato:wght@400;700&family=Montserrat:wght@400;700&display=swap");

      body {
        font-family: "Manrope", sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        overflow-x: hidden;
      }

      img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      h1 {
        font-size: 4rem;
        font-weight: 500;
        line-height: 1;
      }

      p {
        font-size: 1.5rem;
        font-weight: 500;
        line-height: 1;
      }

      section {
        position: relative;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
      }

      .intro,
      .outro {
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #0f0f0f;
        color: #fff;
        padding: 2rem;
        text-align: center;
      }

      .spotlight-intro-text-wrapper {
        position: absolute;
        width: 100%;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        gap: 0.5rem;
        z-index: 3;
      }

      .spotlight-intro-text {
        flex: 1;
      }

      .spotlight-intro-text:nth-child(1) {
        display: flex;
        justify-content: flex-end;
      }

      .spotlight-bg-image {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
        transform: scale(0);
        will-change: transform;
      }

      .spotlight-bg-image img {
        transform: scale(1.5);
        will-change: transform;
      }

      .spotlight-titles-container {
        position: absolute;
        top: 0;
        left: 15vw;
        width: 70%;
        height: 100%;
        overflow: hidden;
        --before-opacity: 0;
        --after-opacity: 0;
        clip-path: polygon(
          50vh 0,
          0 50%,
          50vh 100%,
          100% calc(100% + 100vh),
          100% -100vh
        );
      }

      .spotlight-titles-container::before,
      .spotlight-titles-container::after {
        content: "";
        position: absolute;
        width: 100vh;
        height: 2.5px;
        background: #fff;
        pointer-events: none;
        transition: opacity 0.3s ease;
        z-index: 10;
      }

      .spotlight-titles-container::before {
        top: 0;
        left: 0;
        transform: rotate(-45deg) translate(-7rem);
        opacity: var(--before-opacity);
      }

      .spotlight-titles-container::after {
        bottom: 0;
        left: 0;
        transform: rotate(45deg) translate(-7rem);
        opacity: var(--after-opacity);
      }

      .spotlight-titles {
        position: relative;
        left: 15%;
        width: 75%;
        height: 100%;
        display: flex;
        flex-direction: column;
        gap: 5rem;
        transform: translateY(100vh);
        z-index: 2;
      }

      .spotlight-titles h1 {
        color: #fff;
        opacity: 0.25;
        transition: opacity 0.3s ease;
      }

      .spotlight-titles h1.active {
        opacity: 1;
      }

      .spotlight-images {
        position: absolute;
        top: 0;
        right: 0;
        width: 50%;
        min-width: 300px;
        height: 100%;
        z-index: 1;
        pointer-events: none;
      }

      .spotlight-img {
        position: absolute;
        width: 200px;
        height: 150px;
        will-change: transform, opacity;
      }

      .spotlight-img.active {
        opacity: 1 !important; /* Higher opacity for active image */
      }

      .spotlight-header {
        position: absolute;
        top: 50%;
        left: 10%;
        transform: translateY(-50%);
        color: #fff;
        transition: opacity 0.3s ease;
        z-index: 2;
        opacity: 0;
      }

      @media (max-width: 1000px) {
        .intro,
        .outro {
          padding: 2rem;
          text-align: center;
        }

        .spotlight-titles-container {
          clip-path: none;
        }

        .spotlight-titles-container::before,
        .spotlight-titles-container::after {
          display: none;
        }

        .spotlight-titles {
          left: 0;
        }

        .spotlight-header {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <section class="intro">
      <h1>A curated series of surreal frames.</h1>
    </section>
    <section class="spotlight">
      <div class="spotlight-intro-text-wrapper">
        <div class="spotlight-intro-text">
          <p>Beneath</p>
        </div>
        <div class="spotlight-intro-text">
          <p>Beyond</p>
        </div>
      </div>
      <div class="spotlight-bg-image">
        <img src="/assets/img1.jpg" alt="bg" />
      </div>
      <div class="spotlight-titles-container">
        <div class="spotlight-titles"></div>
      </div>
      <div class="spotlight-images"></div>
      <div class="spotlight-header">
        <p>Discover</p>
      </div>
    </section>
    <section class="outro">
      <h1>Moments still in motion.</h1>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>
    <script>
      const lenis = new Lenis({
        duration: 1.2,
        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
        smooth: true,
      });

      function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
      }

      requestAnimationFrame(raf);

      // Integrate Lenis with GSAP ScrollTrigger
      ScrollTrigger.scrollerProxy(document.body, {
        scrollTop(value) {
          if (arguments.length) {
            lenis.scrollTo(value, { immediate: true });
          }
          return lenis.scroll;
        },
        getBoundingClientRect() {
          return {
            top: 0,
            left: 0,
            width: window.innerWidth,
            height: window.innerHeight,
          };
        },
        pinType: "transform",
      });

      lenis.on("scroll", ScrollTrigger.update);
      gsap.ticker.add((time) => {
        lenis.raf(time * 1000);
      });
      gsap.ticker.lagSmoothing(0);

      const config = {
        gap: 0.08,
        speed: 0.3,
        arcRadius: 500,
      };

      const spotlightItems = [
        { name: "Silent Arc", img: "/assets/img1.jpg" },
        { name: "Bloom", img: "/assets/img2.jpg" },
        { name: "Dark Sky", img: "/assets/img3.jpg" },
        { name: "Moon Glow", img: "/assets/img4.jpg" },
        { name: "Star Dust", img: "/assets/img5.jpg" },
        { name: "Night Wave", img: "/assets/img6.jpg" },
        { name: "Frost", img: "/assets/img7.jpg" },
        { name: "Dawn Light", img: "/assets/img8.jpg" },
        { name: "Mist", img: "/assets/img9.jpg" },
        { name: "Sun Spark", img: "/assets/img10.jpg" },
      ];

      const titlesContainer = document.querySelector(".spotlight-titles");
      const imagesContainer = document.querySelector(".spotlight-images");
      const spotlightHeader = document.querySelector(".spotlight-header");
      const titlesContainerElements = document.querySelector(
        ".spotlight-titles-container"
      );
      const introTextElements = document.querySelectorAll(
        ".spotlight-intro-text"
      );
      const imageElements = [];

      spotlightItems.forEach((item, index) => {
        const titleElement = document.createElement("h1");
        titleElement.textContent = item.name;
        if (index === 0) {
          titleElement.classList.add("active");
        }
        titlesContainer.appendChild(titleElement);

        const imgWrapper = document.createElement("div");
        imgWrapper.className = "spotlight-img";

        const imgElement = document.createElement("img");
        imgElement.src = item.img;
        imgElement.alt = item.name;

        imgWrapper.appendChild(imgElement);
        imagesContainer.appendChild(imgWrapper);
        imageElements.push(imgWrapper);
      });

      const titlesElements = titlesContainer.querySelectorAll("h1");
      let currentActiveIndex = 0;

      const containerWidth = window.innerWidth * 0.3;
      const containerHeight = window.innerHeight;
      const arcStartX = containerWidth - 200;
      const arcStartY = -200;
      const arcEndX = containerWidth + 200;
      const arcEndY = containerHeight + 200;
      const arcControlPointX = arcStartX + config.arcRadius;
      const arcControlPointY = containerHeight / 2;

      function getBezierPosition(t) {
        const x =
          (1 - t) * (1 - t) * arcStartX +
          2 * (1 - t) * t * arcControlPointX +
          t * t * arcEndX;

        const y =
          (1 - t) * (1 - t) * arcStartY +
          2 * (1 - t) * t * arcControlPointY +
          t * t * arcEndY;

        return { x, y };
      }

      function getImgProgressState(index, overallProgress) {
        const startTime = index * config.gap;
        const endTime = startTime + config.speed;
        if (overallProgress < startTime) return -1;
        if (overallProgress > endTime) return 2;
        return (overallProgress - startTime) / config.speed;
      }

      imageElements.forEach((img) => gsap.set(img, { opacity: 0 }));

      ScrollTrigger.create({
        trigger: ".spotlight",
        start: "top top",
        end: `+=${window.innerHeight * 10}px`,
        pin: true,
        pinSpacing: true,
        scrub: 1,
        onUpdate: (self) => {
          const progress = self.progress;

          if (progress <= 0.2) {
            const animationProgress = progress / 0.2;
            const moveDistance = window.innerWidth * 0.6;

            gsap.set(introTextElements[0], {
              x: -animationProgress * moveDistance,
              opacity: 1 - animationProgress,
            });

            gsap.set(introTextElements[1], {
              x: animationProgress * moveDistance,
              opacity: 1 - animationProgress,
            });

            gsap.set(".spotlight-bg-image", {
              transform: `scale(${animationProgress})`,
            });

            gsap.set(".spotlight-bg-image img", {
              transform: `scale(${1.5 - animationProgress * 0.5})`,
            });

            imageElements.forEach((img) => gsap.set(img, { opacity: 0 }));
            spotlightHeader.style.opacity = "0";
            gsap.set(titlesContainerElements, {
              "--before-opacity": "0",
              "--after-opacity": "0",
            });
          } else if (progress > 0.2 && progress <= 0.25) {
            gsap.set(".spotlight-bg-image", { transform: "scale(1)" });
            gsap.set(".spotlight-bg-image img", { transform: "scale(1)" });
            gsap.set(introTextElements[0], { opacity: 0 });
            gsap.set(introTextElements[1], { opacity: 0 });
            imageElements.forEach((img) => gsap.set(img, { opacity: 0 }));
            spotlightHeader.style.opacity = "1";
            gsap.set(titlesContainerElements, {
              "--before-opacity": "1",
              "--after-opacity": "1",
            });
          } else if (progress > 0.25 && progress <= 0.95) {
            gsap.set(".spotlight-bg-image", { transform: "scale(1)" });
            gsap.set(".spotlight-bg-image img", { transform: "scale(1)" });
            gsap.set(introTextElements[0], { opacity: 0 });
            gsap.set(introTextElements[1], { opacity: 0 });
            spotlightHeader.style.opacity = "1";
            gsap.set(titlesContainerElements, {
              "--before-opacity": "1",
              "--after-opacity": "1",
            });

            const switchProgress = (progress - 0.25) / 0.7;
            const viewportHeight = window.innerHeight;
            const titlesContainerHeight = titlesContainer.scrollHeight;
            const startPosition = viewportHeight;
            const targetPosition = -titlesContainerHeight;
            const totalDistance = startPosition - targetPosition;
            const currentY = startPosition - switchProgress * totalDistance;

            gsap.set(".spotlight-titles", {
              y: currentY,
            });

            imageElements.forEach((img, index) => {
              const imageProgress = getImgProgressState(index, switchProgress);

              // Remove active class from all images
              img.classList.remove("active");

              if (imageProgress < 0 || imageProgress > 1) {
                gsap.set(img, { opacity: 0 });
              } else {
                const pos = getBezierPosition(imageProgress);
                gsap.set(img, {
                  x: pos.x - 100,
                  y: pos.y - 75,
                  opacity: index === currentActiveIndex ? 1 : imageProgress, // Higher opacity for active image
                });
                if (index === currentActiveIndex) {
                  img.classList.add("active");
                }
              }
            });

            // Fixed title activation logic
            const viewportMiddle = viewportHeight / 2;
            const activationThreshold = 150; // Distance threshold for activation
            let closestIndex = 0;
            let closestDistance = Infinity;

            titlesElements.forEach((title, index) => {
              const titleRect = title.getBoundingClientRect();
              const titleCenter = titleRect.top + titleRect.height / 2;
              const distanceFromCenter = Math.abs(titleCenter - viewportMiddle);

              if (distanceFromCenter < closestDistance) {
                closestDistance = distanceFromCenter;
                closestIndex = index;
              }
            });

            // Only activate if within threshold and different from current
            if (
              closestDistance < activationThreshold &&
              closestIndex !== currentActiveIndex
            ) {
              // Remove active class from current title
              titlesElements[currentActiveIndex].classList.remove("active");

              // Add active class to new title
              titlesElements[closestIndex].classList.add("active");

              // Update background image
              document.querySelector(".spotlight-bg-image img").src =
                spotlightItems[closestIndex].img;

              currentActiveIndex = closestIndex;
            }
          } else if (progress > 0.95) {
            spotlightHeader.style.opacity = "0";
            gsap.set(titlesContainerElements, {
              "--before-opacity": "0",
              "--after-opacity": "0",
            });
            imageElements.forEach((img) => gsap.set(img, { opacity: 0 }));
          }
        },

        
      });

      // Update ScrollTrigger on window resize
      window.addEventListener("resize", () => {
        ScrollTrigger.refresh();
      });
    </script>
  </body>
</html>
